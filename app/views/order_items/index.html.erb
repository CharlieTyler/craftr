<!-- Look into using a table instead: https://v4-alpha.getbootstrap.com/content/tables/ -->

<div class = "container">
  <div class = "row">
    <%= render partial: 'checkout/checkout_progress', locals: {order: @order} %>
  </div>
  <div class = "row">
    <div class = "col-12">
      <h3>Your basket</h3>
      <div class="basket-header">
        <div class="row">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Subtotal</th>
                <th scope="col">Remove</th>
              </tr>
            </thead>
            <tbody>
              <% @order_items.each do |oi| %>
                <tr>
                  <th scope="row"><%= image_tag oi.product.product_images.first.photo_url(:thumb).to_s, class: "img-fluid" %><%= oi.product.name %></th>
                  <td><%= number_to_currency((oi.product.price / 100).to_f, unit: "£") %></td>
                  <td><%= oi.quantity %></td>
                  <td><%= number_to_currency((oi.subtotal_in_pence / 100).to_f, unit: "£") %></td>
                  <td><%=link_to "Remove", order_item_path(oi), method: :delete %></td>
                </tr>
                <% unless oi.product.is_transactional %>
                  <tr class = "alert alert-danger">
                    <th scope="row">Info</th>
                    <td colspan="4">We are currently out of stock of <%= oi.product.name %>, please <%=link_to "remove from cart", order_item_path(oi), method: :delete %> to continue</td>
                  </tr>
                <% end %>
              <% end %>
              <%= simple_form_for @order, url: checkout_update_shipping_method_path do |f| %>
                <tr>
                  <th scope = "row"><i class="fa fa-truck" aria-hidden="true"></i> Delivery</th>
                  <td><%= f.input :shipping_type_id, collection: @shipping_types, label_method: :full_shipping_type, value_method: :id, label: false, include_blank: false, input_html: {value: @default_shipping_type.id} %>
                    <% if @order.total_unpaid_quantity > 1 %>
                      <p><em><%= number_to_currency(@default_shipping_type.price / (100 * @order.total_unpaid_quantity).to_f, unit: "£") %> shipping per bottle</em></p>
                    <% end %>
                  </td>
                  <td>1</td>
                  <td><%= number_to_currency((@default_shipping_type.price / 100).to_f, unit: "£") %></td>
                  <td></td>
                </tr>
                <tr>
                  <th scope = "row">To pay: </th>
                  <td colspan = "2"></td>
                  <td><strong><%= number_to_currency(((@order.total_unpaid_product_amount + @default_shipping_type.price) / 100).to_f, unit: "£") %></strong></td>
                  <td></td>
                </tr>
                <tr>
                  <th scope = "row" colspan = "5">
                    <%= f.submit "Next: Add delivery address", class: "btn btn-primary col-12" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>      
    </div>
  </div>
</div>

<script>
  //Update delivery total price on delivery total price change
</script>
