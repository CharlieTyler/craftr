<div class = "container-fluid">
  <div class = "owl-carousel owl-theme hero-carousel">
    <%= render partial: "static_pages/carousel_feature", collection: @carousel_features, as: :carousel_feature %>
    </div>
  </div> <!-- Owl carousel -->
</div>

<% unless user_signed_in? %>
  <div class = "background-secondary"> 
    <div class = "container">
      <div class = "row py-2">
        <div class = "col-12 text-center">
          <h6 class = "mt-2 text-white">Make the most of Craftr</h6>
        </div>
        <div class = "col-12 text-center mb-2">
          <%= link_to "Sign in", new_user_session_path, class: "btn btn-primary" %>
          <span class = "text-white"> or </span>
          <%= link_to "Sign up", new_user_registration_path, class: "btn btn-secondary" %>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% @featured_categories.each do |category| %>
  <% if category.products.where(featured: true).size > 0 %>
    <!-- Products -->
    <div class = "products-background" id = "products">
      <div class = "container py-3">
        <div class = "d-inline-block">
          <h3>Featured <%= "#{category.name}s" %></h3>
        </div>
        <div class = "d-inline-block float-right">
          <p class = "text-primary"><%= link_to "See all", category_path(category) %></p>
        </div>
        <div class = "clear"></div>
        <div class = "row text-center">
          <div class = "col-12">
            <div class = "row">
              <%= render partial: "products/lister_item", collection: category.products.where(featured: true), as: :product, locals: { md_upwards_col: (category.products.where(featured: true).size.between?(2, 4) ? 12/(category.products.where(featured: true).size) : 4).to_s, include_add_to_basket: false } %>
            </div>
            <div class = "row">
              <%= link_to "See all our #{category.name}s", category_path(category), class: "btn btn-secondary col-8 offset-2" %>
            </div>
          </div>
        </div>
        <div class = "row">
          <div class = "col-12">
            <hr class = "booyah-line mt-2" />
          </div>
        </div>
      </div>
    </div>
  <% end %>
<% end %>

<!-- Recently viewed -->
<% if user_signed_in? && current_user.recently_viewed_products.present? %>
  <div class = "products-background background-grey">
    <div class = "container py-3">
      <span class = "">
        <h3>Recently viewed</h3>
      </span>
      <div class = "row text-center">
        <div class = "col-12">
          <div class = "row">
            <%= render partial: "products/lister_item", collection: current_user.recently_viewed_products.first(4), as: :product, locals: { include_add_to_basket: true } %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<!-- Recipes -->
<div class = "pt-1" id = "recipes">
  <div class = "container py-3">
    <div class = "d-inline-block">
      <h3>Latest recipes</h3>
    </div>
    <div class = "d-inline-block float-right">
      <p class = "text-primary"><%= link_to "See all", recipes_path %></p>
    </div>
    <div class = "clear"></div>
    <div class = "row text-center">
      <div class = "col-12">
        <div class = "row">
          <%= render partial: "recipes/lister_recipe", collection: @recipes, as: :recipe, locals: { md_upwards_col: "3" } %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class = "container">
  <div class = "row">
    <div class = "col-12">
      <hr class = "booyah-line" />
    </div>
  </div>
</div>

<!-- Distilleries -->
<div class = "" id = "distilleries">
  <div class = "container py-3">
    <div class = "row">
      <div class = "col">
        <div class = "d-inline-block">
          <h3>Newest distilleries</h3>
        </div>
        <div class = "d-inline-block float-right">
          <p class = "text-primary"><%= link_to "See all", distilleries_path %></p>
        </div>
        <div class = "clear"></div>
        <div class = "row py-3 text-center">
          <%= render partial: "distilleries/lister_distillery", collection: @featured_distilleries, as: :distillery %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class = "container">
  <div class = "row">
    <div class = "col-12">
      <hr class = "booyah-line mt-1"/>
    </div>
  </div>
</div>

<% unless @instas.blank? %>
  <div class = "py-3" id = "social">
    <div class = "container">
      <h3>Recent instagrams</h3>
      <h6 class = "text-muted"><%= link_to "@craftrspirits", "http://instagram.com/craftrspirits" %></h6>
      <div class = "row">
        <%= render partial: "static_pages/instagram_tile", collection: @instas.data, as: :insta %>
      </div>
    </div>
  </div>
<% end %>

<script>
  var owl = $('.owl-carousel.hero-carousel'); 
  owl.owlCarousel({
    stagePadding: 0,
    loop:true,
    dots: true,
    items: 1,
    nav: true,
    navText : ['<i class="fa fa-4x fa-angle-left" aria-hidden="true"></i>','<i class="fa fa-4x fa-angle-right" aria-hidden="true"></i>']
  });

  var animation_end = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';
  owl.on('initialized.owl.carousel changed.owl.carousel', function(e) {
    owl.find(".js-animate-me").addClass("fadeInLeft")
    .one(animation_end, function(){ 
      $(this).removeClass("fadeInLeft");
    });
    owl.find(".js-animate-me2").addClass("slideInUp")
    .one(animation_end, function(){
      $(this).removeClass("slideInUp");
    })
  });
</script>
