<% if user_signed_in? && current_user.admin %>
  <div class = "container py-2">
    <div class = "row">
      <div class = "col-md-6 offset-md-3">
        <h6>Admin functions</h6>
        <div class = "row">
          <div class = "col-6">
            <%= link_to "Edit", edit_admin_category_path(@category), class: "btn btn-secondary col-10 offset-1" %>
          </div>
          <div class = "col-6">
            <%= link_to "Delete", admin_category_path(@category), data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-danger col-10 offset-1" %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<div class="py-3" style="
background: #2193b0;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, <%= @category.gradient_from %>, <%= @category.gradient_to %>);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, <%= @category.gradient_from %>, <%= @category.gradient_to.to_s %>); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
">
  <div class = "container">
    <div class = "row">
      <% if @category.banner_image.present? %>
        <div class = "col-5 display-v-middle">
          <%= image_tag @category.banner_image_url(:full), class: "img-fluid" %>
        </div>
      <% end %>
      <div class = "col display-v-middle py-md-5 pr-5">
        <h1 class = "display-4 js-animate-me animated logo-text px-2"><span class = ""><%= title @category.name %></span></h1>
        <% if @category.description.present? %>
          <p class = "js-animate-me2 animated"><%= simple_format @category.description %></p>
        <% end %>
      </div>
    </div>
    <div class = "row py-2">
      <% unless @products.blank? %>
        <div class = "col text-center article-text"><a class="no-click text-white" href="#products"><strong>Products</strong></a></div>
      <% end %>
      <% unless @recipes.blank? %>
        <div class = "col text-center article-text"><a class="no-click text-white" href="#recipes"><strong>Recipes</strong></a></div>
      <% end %>
      <% unless @articles.blank? %>
        <div class = "col text-center article-text"><a class="no-click text-white" href="#articles"><strong>Articles</strong></a></div>
      <% end %>
    </div>
  </div>
</div>

<% unless @products.blank? %>
  <div class = "background-lightgrey">
    <div class = "container py-2">
      <div class = "row" id = "products">
        <div class = "col-md-10 offset-md-1">
          <h3>Products</h3>
          <div class = "row">
            <%= render partial: 'products/lister_item', collection: @category.products.live, as: :product, locals: { include_add_to_basket: true } %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @recipes.blank? %>
  <div class = "">
    <div class = "container py-2">
      <div class = "row" id = "recipes">
        <div class = "col-md-10 offset-md-1">
          <h3>Recipes</h3>
          <div class = "row">
            <%= render partial: 'recipes/lister_recipe', collection: @recipes, as: :recipe %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @articles.blank? %>
  <div class = "background-grey">
    <div class = "container py-2">
      <div class = "row" id = "articles">
        <div class = "col-md-10 offset-md-1">
          <h3>Articles</h3>
          <div class = "row">
            <%= render partial: 'articles/lister_article', collection: @articles, as: :article %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<% unless @instas.blank? %>
  <div class = "background-grey">
    <div class = "container py-2">
      <div class = "row" id = "social">
        <div class = "col-md-10 offset-md-1">
          <h3>Recent instagrams</h3>
          <h6 class = "text-muted"><%= link_to "##{@category.instagram_hashtag}", "http://instagram.com/tags/#{@category.instagram_hashtag}", :target => "_blank" %></h6>
          <div class = "row">
            <%= render partial: "static_pages/instagram_tile", collection: @instas.data, as: :insta %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<script>
  $( document ).on('turbolinks:load', function() { 
  // Scrolling to appropriate area on page
  // Select all links with hashes
  $('a[href*="#"]')
    // Remove links that don't actually link to anything
  .not('[href="#"]')
  .not('[href="#0"]')
  .click(function(event) {
    // On-page links
    if (
      location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
      && 
      location.hostname == this.hostname
    ) {
      // Figure out element to scroll to
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
      // Does a scroll target exist?
      if (target.length) {
        // Only prevent default if animation is actually gonna happen
        event.preventDefault();
        $('html, body').animate({
          scrollTop: target.offset().top
        }, 1000, function() {
          // Callback after animation
          // Must change focus!
          var $target = $(target);
          $target.focus();
          if ($target.is(":focus")) { // Checking if the target was focused
            return false;
          } else {
            $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
            $target.focus(); // Set focus again
          };
        });
      }
    }
  });
});
</script>
